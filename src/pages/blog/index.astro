---
import Header from "../../components/Home/Header.astro";
import Layout from "../../layouts/Layout.astro";


const posts = await Astro.glob('../../posts/*.md');
const Categories = posts.filter((post) => post.frontmatter.category !== undefined).map((cat) => cat.frontmatter.category);
const unique = Categories.filter((v, i, a) => a.indexOf(v) === i)

const categories = unique.map((category:any) => {

  const customizedCategory = posts.filter(
    (post) => {
      if(post.frontmatter.category !== undefined){
        if( post.frontmatter.category === category){
          const item = {
          category: category,
          title: post?.frontmatter?.title,
          author: post?.frontmatter?.author,
          excerpt: post?.frontmatter?.excerpt,
          slug: post?.frontmatter?.slug,
        };
        return item;
        }
      }
     }
  );
return {name: category, posts:customizedCategory}
});

console.log(categories);

---

<Layout title="blog">
    <Header />
    <div class="mx-auto max-w-screen-xl py-8 px-4 sm:py-16 lg:px-6">
       <div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">

        {
          categories.map((cat) => {
            return (
            <div class="rounded p-4 shadow dark:bg-gray-800">
          <div class="mb-4 flex h-10 w-10 items-center justify-center rounded bg-primary-100 dark:bg-primary-900 lg:h-12 lg:w-12">
            <svg class="h-5 w-5 text-primary-600 dark:text-primary-300 lg:h-6 lg:w-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
              <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <h3 class="mb-4 text-xl font-bold dark:text-white capitalize">{cat.name}</h3>
          {
            cat.posts.map((post) => {
              return(
              <ul role="list" class="mb-4 space-y-3 text-gray-500 dark:text-gray-400">
                      <li>
                      <a href={post.frontmatter.slug} class="hover:underline">{post.frontmatter.title}</a>
                      </li>
                  </ul>
              )
            })
          } 
             <a href="#" class="font-medium text-primary-600 hover:underline dark:text-primary-500 float-right">View all</a>
          </div>
            )
          })
        }

      </div>
      
      </div>
</Layout>